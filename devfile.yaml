schemaVersion: 2.2.0
metadata:
  name: polling-app
attributes:
  controller.devfile.io/bootstrap-devworkspace: true
  controller.devfile.io/storage-type: per-workspace

projects:
  - git:
      remotes:
        origin: https://github.com/SmallCloudCo/polling-app.git
    name: polling-app

components:
  - container:
      image: quay.io/devfile/universal-developer-image:ubi8-d071837
      sourceMapping: /projects
    name: universal-developer-image
  - name: prep-workspace
    container:
      args:
        - '-c'
        - >-
          mkdir -p /projects/bin && cp /usr/bin/oc /projects/bin/oc && cp /usr/bin/kubectl /projects/bin/kubectl && if [[ -f ${HOME}/.kube/config ]]; then rm ${HOME}/.kube/config; fi
      command:
        - /bin/bash
      image: image-registry.openshift-image-registry.svc:5000/openshift/cli:latest
      mountSources: true
      sourceMapping: /projects
      memoryRequest: 128Mi
      memoryLimit: 256Mi
      cpuRequest: 10m
      cpuLimit: 200m
      env:
        - name: HOME
          value: "/projects/home"
  - name: git-config
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-d071837
      sourceMapping: /projects
      command: 
        - /bin/bash
      args:
        - '-c'
        - >-
          git config --global user.email "decaturdev@gmail.com" && git config --global user.name "Luis Gonzalez"

commands:
  - apply:
      component: prep-workspace
      label: Copy OpenShift CLI
    id: prep-workspace
  - apply:
      component: git-config
      label: Configure Git
    id: git-config

events:
  preStart:
    - prep-workspace
    - git-config